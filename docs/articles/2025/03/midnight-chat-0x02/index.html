<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>深夜闲谈 0x02 | lisolaris's blog</title>
<meta name=keywords content="2025-03,杂谈,深夜闲谈,Cloudflare,Hugo,PaperMod"><meta name=description content="0x02
又到了晚上闲谈时间——
打算重新把自动控制原理捡起来，虽然以前学过但总归是印象不深，现在打算再照着课本复习一遍，顺便把以前学习时的心得体会记录在博客上。其实这门学科可以说是工科课程的代表：用（相对来说）不那么严谨的数学去解决具有强现实意义的工程问题，同一个问题可以有许多方法相互验证，殊途同归，当然还少不了大量充满奇怪参数的经验公式XD"><meta name=author content="lisolaris"><link rel=canonical href=https://blog.sorali.org/articles/2025/03/midnight-chat-0x02/><meta name=google-site-verification content="njbU0_AKubmw8PZ2_M8dRqYdxfHTDAJSiIIMg8183Gg"><meta name=msvalidate.01 content="2F130D8888E169C0FEDC8FD74C542EB9"><link crossorigin=anonymous href=../../../../assets/css/stylesheet.css rel="preload stylesheet" as=style><link rel=icon href=https://blog.sorali.org/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.sorali.org/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.sorali.org/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.sorali.org/apple-touch-icon.png><link rel=mask-icon href=https://blog.sorali.org/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://blog.sorali.org/articles/2025/03/midnight-chat-0x02/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css integrity="sha512-fHwaWebuwA7NSF5Qg/af4UeDx9XqUpYpOGgubo3yWu+b2IQR4UeQwbb42Ti7gVAjNtVoI/I9TEoYeu9omwcC6g==" crossorigin=anonymous referrerpolicy=no-referrer><script defer src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.js integrity="sha512-LQNxIMR5rXv7o+b1l8+N1EZMfhG7iFZ9HhnbJkTp4zjNr5Wvst75AqUeFDxeRUa7l5vEDyUiAip//r+EFLLCyA==" crossorigin=anonymous referrerpolicy=no-referrer></script><script defer src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/contrib/auto-render.min.js integrity="sha512-iWiuBS5nt6r60fCz26Nd0Zqe0nbk1ZTIQbl3Kv7kYsX+yKMUFHzjaH2+AnM6vp2Xs+gNmaBAVWJjSmuPw76Efg==" crossorigin=anonymous referrerpolicy=no-referrer onload=renderMathInElement(document.body)></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})})</script><link id=hljs-theme rel=stylesheet href><script defer src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/highlight.min.js integrity="sha512-EBLzUL8XLl+va/zAsmXwS7Z2B1F9HUHkZwyS/VKwh3S7T/U0nF4BaU29EP/ZSf6zgiIxYAnKLu6bJ8dqpmX5uw==" crossorigin=anonymous referrerpolicy=no-referrer></script><script>document.addEventListener("DOMContentLoaded",function(){function e(){for(let e of document.getElementsByTagName("pre"))e.querySelector("code").classList.remove("hljs"),e.querySelector("code").removeAttribute("data-highlighted");let e=document.body.classList.contains("dark")?"dark":"light";document.getElementById("hljs-theme").href=`https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/styles/atom-one-${e}.min.css`,hljs.highlightAll()}e();const t=new MutationObserver(t=>{t.forEach(t=>{t.attributeName==="class"&&e()})});t.observe(document.body,{attributes:!0,attributeFilter:["class"]})})</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-WJLMR8Z8YH"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-WJLMR8Z8YH")}</script><meta property="og:url" content="https://blog.sorali.org/articles/2025/03/midnight-chat-0x02/"><meta property="og:site_name" content="lisolaris's blog"><meta property="og:title" content="深夜闲谈 0x02"><meta property="og:description" content="0x02 又到了晚上闲谈时间——
打算重新把自动控制原理捡起来，虽然以前学过但总归是印象不深，现在打算再照着课本复习一遍，顺便把以前学习时的心得体会记录在博客上。其实这门学科可以说是工科课程的代表：用（相对来说）不那么严谨的数学去解决具有强现实意义的工程问题，同一个问题可以有许多方法相互验证，殊途同归，当然还少不了大量充满奇怪参数的经验公式XD"><meta property="og:locale" content="zh-CN"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-03-18T00:50:15+08:00"><meta property="article:modified_time" content="2025-03-18T00:50:15+08:00"><meta property="article:tag" content="2025-03"><meta property="article:tag" content="杂谈"><meta property="article:tag" content="深夜闲谈"><meta property="article:tag" content="Cloudflare"><meta property="article:tag" content="Hugo"><meta property="article:tag" content="PaperMod"><meta property="og:image" content="https://s.gravatar.com/avatar/ca6b899274fa556db7e5cf9c54325448"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://s.gravatar.com/avatar/ca6b899274fa556db7e5cf9c54325448"><meta name=twitter:title content="深夜闲谈 0x02"><meta name=twitter:description content="0x02
又到了晚上闲谈时间——
打算重新把自动控制原理捡起来，虽然以前学过但总归是印象不深，现在打算再照着课本复习一遍，顺便把以前学习时的心得体会记录在博客上。其实这门学科可以说是工科课程的代表：用（相对来说）不那么严谨的数学去解决具有强现实意义的工程问题，同一个问题可以有许多方法相互验证，殊途同归，当然还少不了大量充满奇怪参数的经验公式XD"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"深夜闲谈 0x02","item":"https://blog.sorali.org/articles/2025/03/midnight-chat-0x02/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"深夜闲谈 0x02","name":"深夜闲谈 0x02","description":"0x02 又到了晚上闲谈时间——\n打算重新把自动控制原理捡起来，虽然以前学过但总归是印象不深，现在打算再照着课本复习一遍，顺便把以前学习时的心得体会记录在博客上。其实这门学科可以说是工科课程的代表：用（相对来说）不那么严谨的数学去解决具有强现实意义的工程问题，同一个问题可以有许多方法相互验证，殊途同归，当然还少不了大量充满奇怪参数的经验公式XD\n","keywords":["2025-03","杂谈","深夜闲谈","Cloudflare","Hugo","PaperMod"],"articleBody":"0x02 又到了晚上闲谈时间——\n打算重新把自动控制原理捡起来，虽然以前学过但总归是印象不深，现在打算再照着课本复习一遍，顺便把以前学习时的心得体会记录在博客上。其实这门学科可以说是工科课程的代表：用（相对来说）不那么严谨的数学去解决具有强现实意义的工程问题，同一个问题可以有许多方法相互验证，殊途同归，当然还少不了大量充满奇怪参数的经验公式XD\n用Cloudflare Tunnel隐藏RESTful API的源地址 最近研究了Cloudflare Workers，想把之前一直跑在本地小香橙派上的Minecraft服务器白名单自助注册后端迁移上去以避免家宽提供HTTP服务被运营商扫到ban宽带的问题。原本的流程是本地跑着用Python Flask写的简易后端，维护一个白名单列表并与远程的Minecraft服务器通过RCON同步；前端是一个托管在Cloudflare Pages上的静态页面，用户填完信息后点击确定就会发起XHR请求把数据POST到后端API，后端验证Token正确、确实不在白名单里就会执行whitelist add 把用户添加到白名单。Token是预共享的，本来也只是为了把扫IP的机器人挡在外面，不需要很高的安全性。\n但是研究半天Node.js后写好了代码，测试的时候怎么都不行。一查发现Cloudflare Workers不支持发起TCP请求，也就不能直接与Minecraft服务器通信；退而求其次，尝试让Workers与现有的后端通信，Workers本身起一个隐藏源站地址和流量筛选的作用也不行，Workers只能与常见的80 443 8080等端口1通信，而本地的后端为了安全性没开这些端口，用了一个高位的端口提供服务。\n最后发现了解决方案：直接使用Cloudflare Tunnel作为反向代理，也就不用暴露本地的后端服务到公网上了。为了使用Tunnel，需要在本地的机器上跑一个cloudflared客户端。这个客户端原生支持armhf，直接从Github下载deb包后dpkg -i安装，再从Tunnel控制台复制带Token的命令在本地运行就可以了。\n将博客从Github Pages迁移到Cloudflare Pages 今天还将博客从Github Pages上面迁移到了Cloudflare Pages上。迁移的过程意外的简单，直接在Cloudflare Pages控制台里指定从Github仓库导入，指定好发布时使用的文件夹就可以了。实际上Pages还能够直接在它的云端运行Hugo生成静态页面，但我实测CF的Hugo版本太低，而且我之前也一直是本地生成后push到Github部署的；于是直接选择部署类型为None，指定好存放静态页面的文件夹后保存部署即可。\n之后去Github仓库里把Github Pages自动部署删除并释放CNAME域名，再在CF里将这个域名指派给Cloudflare Pages就可以了。证书什么的CF都会自动处理好，用户只需要点点鼠标就可以启用HTTPS加密。\n迁移过来后本来还想着去百度注册一下站点，结果要填一大堆信息（从姓名填到微信QQ号），想想还是算了。\n改变Hugo生成的文章URL格式 之前的文章都是按标题生成URL的（比如https://blog.sorali.org/2024/08/%E7%A1%AC%E6%94%B9%E8%81%94%E6%83%B3m910q%E5%B0%8F%E4%B8%BB%E6%9C%BA%E5%A2%9E%E5%8A%A0%E7%AC%AC%E4%BA%8C%E4%B8%AAm.2%E6%8E%A5%E5%8F%A3/），不仅不好复制搜索引擎收录的时候也不太好。于是把每个帖子的源Markdown文件都改成了英文名和连字符的形式，看起来就像这样：https://blog.sorali.org/articles/2025/03/midnight-chat-0x02/\n另外还加了分类，把帖子放在content/posts下，教程放在content/tutorials下。然后在config.yaml里配置站点文件结构后重新生成站点即可：\nparams: mainSections: - posts - tutorials permalinks: page: posts: /articles/:year/:month/:filename/ tutorials: /tutorials/:year/:month/:filename/ section: posts: /articles/ tutorials: /tutorials/ 当然旧中文格式的文件我也都没删，全部保留了。新的sitemap.xml中不会包含这些内容，因此它们应该会慢慢被搜索引擎遗忘（\n刚刚发现旧中文格式的文件似乎用的是我最后一次执行hugo server -D时的生成，导致文章内的本站链接全部是http://localhost:1313……考虑要不要把config.yaml改回原来的格式重新生成一次站点……\n让Markdown表格居中显示 最近看Bing搜索后台时发现之前写的那篇硬改联想M910q小主机增加第二个M.2接口文章还挺多人看的，遂补充了一下，修改了一些段落问题，补充了一个BOM表。但是马上就注意到表格居然和其他正文左对齐了，于是研究了一下怎么让它居中：在themes\\PaperMod\\assets\\css\\extended目录下新建一个custom.css（当然也可以用原本就有的那个blank.css，但我比较喜欢自己加），粘贴如下内容：\n/* Markdown表格居中 */ table{ width: auto; display: table; margin-left: auto; margin-right: auto; } 之后重新生成站点就能看到表格已经居中了。\n为PaperMod主题增加$\\LaTeX$支持 写自控笔记时必然要使用LaTeX插入公式，但PaperMod主题默认并不支持$\\LaTeX$。好在主题支持在生成的网页开头/结尾加入元素用于添加自定义的css/js2。我参考了kiwamizamurai写的这篇教程：\n首先在博客仓库layouts/partials目录下新建一个文件并命名为extend_head.html，填充如下内容：\n{{ if or .Params.math .Site.Params.math }} \u003e {{ end }} 以上代码和kiwamizamurai原帖中的代码有些差异，是因为我从$\\KaTeX$（解决这个问题的核心，一个用于实现纯前端渲染LaTeX代码的JavaScript库）的官方库中copy了一份新版本的示例，包含更新的版本号和与之对应的sha384。代码的大致功能是从jsDelivr CDN拉取KaTeX的本体和对应的样式表，并在整个页面加载完成后遍历页面中字符将未渲染的、由$或$$包围的字符渲染成数学公式。\n之后还需要在Hugo的配置中将params.math设置为true，以启用这个扩展的head：\nparams: math: true 重新用Hugo生成页面，可以看到$\\LaTeX$公式已经被正确渲染了。\n为PaperMod主题增加代码块高亮适应亮/暗模式 本来只是自己嫌丑想加这个功能的，结果弄着弄着发现坑还不少，新开了一个文章讲了。可以移步：为PaperMod主题增加代码语法高亮适应亮/暗模式。\n为站点添加评论功能（使用giscus） 这个做起来其实挺简单的。我选择的是giscus，点进网站后直接就有新手指导，把自己仓库的信息填入、在Github上授权giscus bot访问你账户下的仓库，之后就可以一键复制配置了。\n在layouts\\partials\\目录下新建一个extend_footer.html，先把这一段贴进去，作用是用Hugo语法排除掉首页：\n{{if not .IsHome}} {{end}} 再将复制的","wordCount":"3941","inLanguage":"en","image":"https://s.gravatar.com/avatar/ca6b899274fa556db7e5cf9c54325448","datePublished":"2025-03-18T00:50:15+08:00","dateModified":"2025-03-18T00:50:15+08:00","author":{"@type":"Person","name":"lisolaris"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.sorali.org/articles/2025/03/midnight-chat-0x02/"},"publisher":{"@type":"Organization","name":"lisolaris's blog","logo":{"@type":"ImageObject","url":"https://blog.sorali.org/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.sorali.org/ accesskey=h title="Home (Alt + H)">Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://blog.sorali.org/categories/ title=目录><span>目录</span></a></li><li><a href=https://blog.sorali.org/tags/ title=标签><span>标签</span></a></li><li><a href=https://blog.sorali.org/posts/helloworld/ title=关于><span>关于</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://blog.sorali.org/>Home</a></div><h1 class="post-title entry-hint-parent">深夜闲谈 0x02</h1><div class=post-meta><span title='2025-03-18 00:50:15 +0800 CST'>March 18, 2025</span>&nbsp;·&nbsp;8 min&nbsp;·&nbsp;3941 words&nbsp;·&nbsp;lisolaris&nbsp;|&nbsp;<a href=https://github.com/lisolaris/lisolaris.github.io/issues/new rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#0x02 aria-label=0x02>0x02</a></li><li><a href=#%e7%94%a8cloudflare-tunnel%e9%9a%90%e8%97%8frestful-api%e7%9a%84%e6%ba%90%e5%9c%b0%e5%9d%80 aria-label="用Cloudflare Tunnel隐藏RESTful API的源地址">用Cloudflare Tunnel隐藏RESTful API的源地址</a></li><li><a href=#%e5%b0%86%e5%8d%9a%e5%ae%a2%e4%bb%8egithub-pages%e8%bf%81%e7%a7%bb%e5%88%b0cloudflare-pages aria-label="将博客从Github Pages迁移到Cloudflare Pages">将博客从Github Pages迁移到Cloudflare Pages</a></li><li><a href=#%e6%94%b9%e5%8f%98hugo%e7%94%9f%e6%88%90%e7%9a%84%e6%96%87%e7%ab%a0url%e6%a0%bc%e5%bc%8f aria-label=改变Hugo生成的文章URL格式>改变Hugo生成的文章URL格式</a></li><li><a href=#%e8%ae%a9markdown%e8%a1%a8%e6%a0%bc%e5%b1%85%e4%b8%ad%e6%98%be%e7%a4%ba aria-label=让Markdown表格居中显示>让Markdown表格居中显示</a></li><li><a href=#%e4%b8%bapapermod%e4%b8%bb%e9%a2%98%e5%a2%9e%e5%8a%a0latex%e6%94%af%e6%8c%81 aria-label=为PaperMod主题增加$\LaTeX$支持>为PaperMod主题增加$\LaTeX$支持</a></li><li><a href=#%e4%b8%bapapermod%e4%b8%bb%e9%a2%98%e5%a2%9e%e5%8a%a0%e4%bb%a3%e7%a0%81%e5%9d%97%e9%ab%98%e4%ba%ae%e9%80%82%e5%ba%94%e4%ba%ae%e6%9a%97%e6%a8%a1%e5%bc%8f aria-label=为PaperMod主题增加代码块高亮适应亮/暗模式>为PaperMod主题增加代码块高亮适应亮/暗模式</a></li><li><a href=#%e4%b8%ba%e7%ab%99%e7%82%b9%e6%b7%bb%e5%8a%a0%e8%af%84%e8%ae%ba%e5%8a%9f%e8%83%bd%e4%bd%bf%e7%94%a8giscus aria-label=为站点添加评论功能（使用giscus）>为站点添加评论功能（使用giscus）</a></li></ul></div></details></div><div class=post-content><h3 id=0x02>0x02<a hidden class=anchor aria-hidden=true href=#0x02>#</a></h3><p>又到了晚上闲谈时间——</p><p>打算重新把自动控制原理捡起来，虽然以前学过但总归是印象不深，现在打算再照着课本复习一遍，顺便把以前学习时的心得体会记录在博客上。其实这门学科可以说是工科课程的代表：用（相对来说）不那么严谨的数学去解决具有强现实意义的工程问题，同一个问题可以有许多方法相互验证，殊途同归，当然还少不了大量充满奇怪参数的经验公式XD</p><hr><h3 id=用cloudflare-tunnel隐藏restful-api的源地址>用Cloudflare Tunnel隐藏RESTful API的源地址<a hidden class=anchor aria-hidden=true href=#用cloudflare-tunnel隐藏restful-api的源地址>#</a></h3><p>最近研究了Cloudflare Workers，想把之前一直跑在本地小香橙派上的Minecraft服务器白名单自助注册后端迁移上去以避免家宽提供HTTP服务被运营商扫到ban宽带的问题。原本的流程是本地跑着用Python Flask写的简易后端，维护一个白名单列表并与远程的Minecraft服务器通过RCON同步；前端是一个托管在Cloudflare Pages上的静态页面，用户填完信息后点击确定就会发起XHR请求把数据POST到后端API，后端验证Token正确、确实不在白名单里就会执行<code>whitelist add &lt;username></code>把用户添加到白名单。Token是预共享的，本来也只是为了把扫IP的机器人挡在外面，不需要很高的安全性。</p><p>但是研究半天Node.js后写好了代码，测试的时候怎么都不行。一查发现Cloudflare Workers不支持发起TCP请求，也就不能直接与Minecraft服务器通信；退而求其次，尝试让Workers与现有的后端通信，Workers本身起一个隐藏源站地址和流量筛选的作用也不行，Workers只能与常见的80 443 8080等端口<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>通信，而本地的后端为了安全性没开这些端口，用了一个高位的端口提供服务。</p><p>最后发现了解决方案：直接使用Cloudflare Tunnel作为反向代理，也就不用暴露本地的后端服务到公网上了。为了使用Tunnel，需要在本地的机器上跑一个<code>cloudflared</code>客户端。这个客户端原生支持<code>armhf</code>，直接从Github下载deb包后<code>dpkg -i</code>安装，再从Tunnel控制台复制带Token的命令在本地运行就可以了。</p><hr><h3 id=将博客从github-pages迁移到cloudflare-pages>将博客从Github Pages迁移到Cloudflare Pages<a hidden class=anchor aria-hidden=true href=#将博客从github-pages迁移到cloudflare-pages>#</a></h3><p>今天还将博客从Github Pages上面迁移到了Cloudflare Pages上。迁移的过程意外的简单，直接在Cloudflare Pages控制台里指定从Github仓库导入，指定好发布时使用的文件夹就可以了。实际上Pages还能够直接在它的云端运行Hugo生成静态页面，但我实测CF的Hugo版本太低，而且我之前也一直是本地生成后push到Github部署的；于是直接选择部署类型为None，指定好存放静态页面的文件夹后保存部署即可。</p><p>之后去Github仓库里把Github Pages自动部署删除并释放CNAME域名，再在CF里将这个域名指派给Cloudflare Pages就可以了。证书什么的CF都会自动处理好，用户只需要点点鼠标就可以启用HTTPS加密。</p><p>迁移过来后本来还想着去百度注册一下站点，结果要填一大堆信息（从姓名填到微信QQ号），想想还是算了。</p><hr><h3 id=改变hugo生成的文章url格式>改变Hugo生成的文章URL格式<a hidden class=anchor aria-hidden=true href=#改变hugo生成的文章url格式>#</a></h3><p>之前的文章都是按标题生成URL的（比如<a href=https://blog.sorali.org/2024/08/%E7%A1%AC%E6%94%B9%E8%81%94%E6%83%B3m910q%E5%B0%8F%E4%B8%BB%E6%9C%BA%E5%A2%9E%E5%8A%A0%E7%AC%AC%E4%BA%8C%E4%B8%AAm.2%E6%8E%A5%E5%8F%A3/>https://blog.sorali.org/2024/08/%E7%A1%AC%E6%94%B9%E8%81%94%E6%83%B3m910q%E5%B0%8F%E4%B8%BB%E6%9C%BA%E5%A2%9E%E5%8A%A0%E7%AC%AC%E4%BA%8C%E4%B8%AAm.2%E6%8E%A5%E5%8F%A3/</a>），不仅不好复制搜索引擎收录的时候也不太好。于是把每个帖子的源Markdown文件都改成了英文名和连字符的形式，看起来就像这样：<a href=https://blog.sorali.org/articles/2025/03/midnight-chat-0x02/>https://blog.sorali.org/articles/2025/03/midnight-chat-0x02/</a></p><p>另外还加了分类，把帖子放在<code>content/posts</code>下，教程放在<code>content/tutorials</code>下。然后在<code>config.yaml</code>里配置站点文件结构后重新生成站点即可：</p><pre><code class=language-yaml>params:
  mainSections:
    - posts
    - tutorials

permalinks:
  page:
    posts: /articles/:year/:month/:filename/
    tutorials: /tutorials/:year/:month/:filename/
  section:
    posts: /articles/
    tutorials: /tutorials/
</code></pre><p><del>当然旧中文格式的文件我也都没删，全部保留了。新的<code>sitemap.xml</code>中不会包含这些内容，因此它们应该会慢慢被搜索引擎遗忘（</del></p><p>刚刚发现旧中文格式的文件似乎用的是我最后一次执行<code>hugo server -D</code>时的生成，导致文章内的本站链接全部是<a href=http://localhost:1313>http://localhost:1313</a>……考虑要不要把<code>config.yaml</code>改回原来的格式重新生成一次站点……</p><hr><h3 id=让markdown表格居中显示>让Markdown表格居中显示<a hidden class=anchor aria-hidden=true href=#让markdown表格居中显示>#</a></h3><p>最近看Bing搜索后台时发现之前写的那篇<a href=https://blog.sorali.org/articles/2024/08/add-second-m2-slot-on-lenovo-m910q/>硬改联想M910q小主机增加第二个M.2接口</a>文章还挺多人看的，遂补充了一下，修改了一些段落问题，补充了一个BOM表。但是马上就注意到表格居然和其他正文左对齐了，于是研究了一下怎么让它居中：在<code>themes\PaperMod\assets\css\extended</code>目录下新建一个<code>custom.css</code>（当然也可以用原本就有的那个<code>blank.css</code>，但我比较喜欢自己加），粘贴如下内容：</p><pre><code class=language-css>/* Markdown表格居中 */
table{
  width: auto;
  display: table;
  margin-left: auto;
  margin-right: auto;
}
</code></pre><p>之后重新生成站点就能看到表格已经居中了。</p><hr><h3 id=为papermod主题增加latex支持>为PaperMod主题增加$\LaTeX$支持<a hidden class=anchor aria-hidden=true href=#为papermod主题增加latex支持>#</a></h3><p>写自控笔记时必然要使用LaTeX插入公式，但PaperMod主题默认并不支持$\LaTeX$。好在主题支持在生成的网页开头/结尾加入元素用于添加自定义的css/js<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>。我参考了<a href=https://github.com/kiwamizamurai>kiwamizamurai</a>写的这篇<a href=https://kiwamizamurai.github.io/posts/2022-03-06/>教程</a>：</p><p>首先在博客仓库<code>layouts/partials</code>目录下新建一个文件并命名为<code>extend_head.html</code>，填充如下内容：</p><pre><code class=language-html>{{ if or .Params.math .Site.Params.math }}
&lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/katex.min.css&quot; integrity=&quot;sha384-zh0CIslj+VczCZtlzBcjt5ppRcsAmDnRem7ESsYwWwg3m/OaJ2l4x7YBZl9Kxxib&quot; crossorigin=&quot;anonymous&quot;&gt;

&lt;!-- The loading of KaTeX is deferred to speed up page rendering --&gt;
&lt;script defer src=&quot;https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/katex.min.js&quot; integrity=&quot;sha384-Rma6DA2IPUwhNxmrB/7S3Tno0YY7sFu9WSYMCuulLhIqYSGZ2gKCJWIqhBWqMQfh&quot; crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;

&lt;!-- To automatically render math in text elements, include the auto-render extension: --&gt;
&lt;script defer src=&quot;https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/contrib/auto-render.min.js&quot; integrity=&quot;sha384-hCXGrW6PitJEwbkoStFjeJxv+fSOOQKOPbJxSfM6G5sWZjAyWhXiTIIAmQqnlLlh&quot; crossorigin=&quot;anonymous&quot;
    onload=&quot;renderMathInElement(document.body);&quot;&gt;&lt;/script&gt;

&lt;!-- for inline --&gt;&gt;
&lt;script&gt;
document.addEventListener(&quot;DOMContentLoaded&quot;, function() {
    renderMathInElement(document.body, {
        delimiters: [
            {left: &quot;$$&quot;, right: &quot;$$&quot;, display: true},
            {left: &quot;$&quot;, right: &quot;$&quot;, display: false}
        ]
    });
});
&lt;/script&gt;
{{ end }}
</code></pre><p>以上代码和kiwamizamurai原帖中的代码有些差异，是因为我从$\KaTeX$（解决这个问题的核心，一个用于实现纯前端渲染LaTeX代码的JavaScript库）的官方库中copy了一份新版本的示例，包含更新的版本号和与之对应的sha384。代码的大致功能是从jsDelivr CDN拉取KaTeX的本体和对应的样式表，并在整个页面加载完成后遍历页面中字符将未渲染的、由<code>$</code>或<code>$$</code>包围的字符渲染成数学公式。</p><p>之后还需要在Hugo的配置中将<code>params.math</code>设置为<code>true</code>，以启用这个扩展的head：</p><pre><code class=language-yaml>params:
  math: true
</code></pre><p>重新用Hugo生成页面，可以看到$\LaTeX$公式已经被正确渲染了。</p><hr><h3 id=为papermod主题增加代码块高亮适应亮暗模式>为PaperMod主题增加代码块高亮适应亮/暗模式<a hidden class=anchor aria-hidden=true href=#为papermod主题增加代码块高亮适应亮暗模式>#</a></h3><p>本来只是自己嫌丑想加这个功能的，结果弄着弄着发现坑还不少，新开了一个文章讲了。可以移步：<a href=https://blog.sorali.org/articles/2025/03/add-code-highlight-adjust-light-dark-theme/>为PaperMod主题增加代码语法高亮适应亮/暗模式</a>。</p><hr><h3 id=为站点添加评论功能使用giscus>为站点添加评论功能（使用giscus）<a hidden class=anchor aria-hidden=true href=#为站点添加评论功能使用giscus>#</a></h3><p>这个做起来其实挺简单的。我选择的是<a href=https://giscus.app>giscus</a>，点进网站后直接就有新手指导，把自己仓库的信息填入、在Github上授权giscus bot访问你账户下的仓库，之后就可以一键复制配置了。</p><pre><code class=language-html>&lt;script src=&quot;https://giscus.app/client.js&quot;
        data-repo=&quot;[在此输入仓库]&quot;
        data-repo-id=&quot;[在此输入仓库 ID]&quot;
        data-category=&quot;[在此输入分类名]&quot;
        data-category-id=&quot;[在此输入分类 ID]&quot;
        data-mapping=&quot;pathname&quot;
        data-strict=&quot;0&quot;
        data-reactions-enabled=&quot;1&quot;
        data-emit-metadata=&quot;0&quot;
        data-input-position=&quot;bottom&quot;
        data-theme=&quot;preferred_color_scheme&quot;
        data-lang=&quot;zh-CN&quot;
        crossorigin=&quot;anonymous&quot;
        async&gt;
&lt;/script&gt;
</code></pre><p>在<code>layouts\partials\</code>目录下新建一个<code>extend_footer.html</code>，先把这一段贴进去，作用是用Hugo语法排除掉首页：</p><pre><code class=language-txt>{{if not .IsHome}}

{{end}}
</code></pre><p>再将复制的<code>&lt;script></code>元素粘贴到中间的空行，站点的giscus评论区就基本可用了。但为了适配PaperMod，我们还要做一些改动：</p><p>首先在选择主题时需要使用<code>noborder_light</code>或<code>noborder_dark</code>主题，这两个主题恰好与PaperMod的亮/暗主题完全适配；</p><p>然后由于giscus默认宽度是占满整个网页的，需要在<code>themes\PaperMod\assets\css\extended\custom.css</code>中加入如下样式：</p><pre><code class=language-css>.giscus{
  width: var(--main-width);
  margin: auto;
}
</code></pre><p>这两个样式的作用在于覆盖giscus默认的<code>width: 100%</code>，限制评论区<code>&lt;iframe></code>的宽度与正文保持一致，并使得评论区居中。</p><p>之后还需要修改<code>themes\PaperMod\layouts\partials\footer.html</code>，在这个文件最顶端添加：</p><pre><code class=language-html>&lt;div class=&quot;giscus&quot;&gt;&lt;/div&gt;
</code></pre><p>这里的作用在于把评论区放在<code>© 2025 lisolaris's blog · Powered by Hugo & PaperMod</code>这行字上面。默认情况下giscus会在添加client脚本的位置插入评论区页面，但<code>extend_footer.html</code>中的内容会被插入到模板自带的<code>footer.html</code>之后，导致评论区会显示在版权声明下面；好在giscus会优先检索页面中具有<code>giscus</code>属性的元素并把评论区插入到那里，于是我们只要先手动建立一个空的<code>&lt;div class="giscus">&lt;/div></code>就可以指定评论区的位置了。</p><p>之后重新生成站点，应该可以看到评论区出现在正确的位置了，访客可以使用自己的Github账号登录后留言！</p><p>目前giscus还存在一个问题：评论区使用的主题在执行<code>client.js</code>时就已经确定，之后插入的页面是一个<code>&lt;iframe></code>，直接从站点下执行JavaScript无法跨域操作里面的内容。要增加主题动态加载功能可能需要fork一份giscus的<code>client.js</code>，有些麻烦暂且跳过。</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p><a href=https://developers.cloudflare.com/fundamentals/reference/network-ports/>https://developers.cloudflare.com/fundamentals/reference/network-ports/</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p><a href=https://github.com/adityatelange/hugo-PaperMod/wiki/FAQs#custom-head--footer>https://github.com/adityatelange/hugo-PaperMod/wiki/FAQs#custom-head--footer</a>&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://blog.sorali.org/tags/2025-03/>2025-03</a></li><li><a href=https://blog.sorali.org/tags/%E6%9D%82%E8%B0%88/>杂谈</a></li><li><a href=https://blog.sorali.org/tags/%E6%B7%B1%E5%A4%9C%E9%97%B2%E8%B0%88/>深夜闲谈</a></li><li><a href=https://blog.sorali.org/tags/cloudflare/>Cloudflare</a></li><li><a href=https://blog.sorali.org/tags/hugo/>Hugo</a></li><li><a href=https://blog.sorali.org/tags/papermod/>PaperMod</a></li></ul><nav class=paginav><a class=prev href=https://blog.sorali.org/articles/2025/03/add-code-highlight-adjust-light-dark-theme/><span class=title>« Prev</span><br><span>为PaperMod主题增加代码语法高亮适应亮/暗模式</span>
</a><a class=next href=https://blog.sorali.org/articles/2025/03/control-theory-review-01/><span class=title>Next »</span><br><span>自动控制原理 - 01 - 一般概念，数学模型与拉普拉斯变换</span></a></nav></footer></article></main><div class=giscus></div><footer class=footer><span>&copy; 2025 <a href=https://blog.sorali.org/>lisolaris's blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script id=giscus-script src=https://giscus.app/client.js data-repo=lisolaris/lisolaris.github.io data-repo-id=R_kgDOI1UN9A data-category=Announcements data-category-id=DIC_kwDOI1UN9M4CoQUt data-mapping=title data-strict=1 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=noborder_light data-lang=zh-CN data-loading=lazy crossorigin=anonymous async></script><script>(function(){let e=document.querySelector("footer.footer");e.insertAdjacentHTML("beforeend","<br>"),e.insertAdjacentHTML("beforeend",'<a href="https://icp.gov.moe/?keyword=20251096" target="_blank">萌ICP备20251096号</a>')})()</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>